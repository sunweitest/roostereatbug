<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†äº«BUG</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="vue.global.js"></script>
    <script src="axios.min.js"></script>
</head>

<body class="bg-gray-50 p-5" style="background-color: darkseagreen">
    <div id="app" class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
            <span class="mr-2">ğŸ“</span>åˆ†äº«BUG
        </h1>

    <!-- <iframe
    src="http://localhost/chatbot/xFv0ot5dIDplRpMj"
    style="width: 100%; height: 100%; min-height: 700px"
    frameborder="0"
    allow="microphone">
    </iframe> -->
    
        <!-- æ·»åŠ /æœç´¢åŒºåŸŸ -->
        <div class="flex gap-3 mb-6">
            <input 
                v-model="searchKeyword" 
                @input="searchBugs"
                placeholder="æœç´¢BUG..." 
                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"
            >
            <!-- <button 
                @click="showAddForm = !showAddForm"
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
            >
                æ–°å»ºBUG
            </button> -->
            <button @click="showModal = true" class="px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                åŠ åé¦ˆç¾¤
              </button>
            

              <div v-if="showModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
                <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm text-center relative">
                  <!-- å…³é—­æŒ‰é’® -->
                  <button @click="showModal = false" class="absolute top-2 right-2 text-gray-600 hover:text-gray-800">
                    &times;
                  </button>
          
                  <!-- äºŒç»´ç å›¾ç‰‡ -->
                  <img src="./qrcode.png" alt="ç¾¤äºŒç»´ç " class="w-full h-auto mb-4" />
                  
                  <p class="text-gray-700">ç”¨QQæ‰«ç åŠ å…¥åé¦ˆç¾¤</p>
                </div>
              </div>  
        </div>

        <!-- æ–°å»ºBUGè¡¨å• -->
        <div v-if="showAddForm" class="bg-white p-6 rounded-xl shadow-md mb-6">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">æ–°å»ºBUG</h3>
            <form @submit.prevent="createBug" class="space-y-4">
                <div>
                    <input 
                        v-model="newBug.title" 
                        placeholder="æ ‡é¢˜" 
                        required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    >
                </div>
                <div>
                    <textarea 
                        v-model="newBug.description" 
                        placeholder="æè¿°" 
                        required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-24"
                    ></textarea>
                </div>
                <div>
                    <select 
                        v-model="newBug.status"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    >
                        <option value=0>å¾…å¤„ç†</option>
                        <option value=1>å·²è§£å†³</option>
                    </select>
                </div>
                <button 
                    type="submit"
                    class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors"
                >
                    æäº¤
                </button>
            </form>
        </div>

        <!-- BUGåˆ—è¡¨ -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">æ ‡é¢˜</th>
                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">æè¿°</th>
                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">çŠ¶æ€</th>
                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-500">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    <tr v-for="bug in filteredBugs" :key="bug.id" class="hover:bg-gray-50 transition-colors">
                        <td class="px-4 py-3 text-gray-700">{{ bug.title }}</td>
                        <td class="px-4 py-3 text-gray-600">{{ bug.description }}</td>
                        <td class="px-4 py-3">
                            <span 
                                class="px-2 py-1 text-sm rounded-full"
                                :class="bug.status === 0 ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800'"
                            >
                                {{ bug.status === 0 ? 'å¾…å¤„ç†' : 'å·²è§£å†³' }}
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex gap-2">
                                <button 
                                    @click="openEditModal(bug)"
                                    class="px-3 py-1 text-sm bg-blue-100 text-blue-600 rounded-md hover:bg-blue-200 transition-colors"
                                >
                                    æŸ¥çœ‹è§£å†³æ–¹æ³•
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ç¼–è¾‘æ¨¡æ€æ¡† -->
        <div v-if="showEditModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-md p-6 rounded-xl shadow-xl">
                <h3 class="text-xl font-semibold text-gray-700 mb-4" style="color:green">è§£å†³æ–¹æ³•</h3>
                <form @submit.prevent="updateBug" class="space-y-1">
                    <label >AIç”Ÿæˆ</label>
                    <div>
                        <textarea 
                        v-model="editingBug.solution"
                        required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 h-36"
                    ></textarea>
                    </div>
                    <div class="flex gap-2 justify-end">
                        <button 
                            type="button"
                            @click="showEditModal = false"
                            class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-md transition-colors"
                        >
                            è¿”å›
                        </button>
                        <!-- <button 
                            type="submit"
                            class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
                        >
                            ä¿å­˜
                        </button> -->
                    </div>
                </form>
            </div>
        </div>
    </div>

<script>
const { createApp } = Vue;

createApp({
    data() {
        return {
            bugs: [],
            newBug: {
                title: '',
                description: '',
                status: 'å¾…å¤„ç†'
            },
            searchKeyword: '',
            editingBug: {},
            showModal: false,
            showEditModal: false,
            showAddForm: false
        }
    },
    computed: {
        filteredBugs() {
            return this.bugs.filter(bug => 
                bug.title.toLowerCase().includes(this.searchKeyword.toLowerCase()) ||
                bug.description.toLowerCase().includes(this.searchKeyword.toLowerCase())
            );
        }
    },
    mounted() {
        this.fetchBugs();
    },
    methods: {
        async fetchBugs() {
            try {
                const response = await axios.get('http://127.0.0.1:8000/bugs');
                this.bugs = response.data;
            } catch (error) {
                console.error('è·å–BUGåˆ—è¡¨å¤±è´¥:', error);
            }
        },
        async createBug() {
            try {
                await axios.post('http://127.0.0.1:8000/bugs', this.newBug);
                this.newBug = { title: '', description: '', status: 'å¾…å¤„ç†' };
                this.showAddForm = false;
                await this.fetchBugs();
            } catch (error) {
                console.error('åˆ›å»ºBUGå¤±è´¥:', error);
            }
        },
        async updateBug() {
            try {
                await axios.put(`http://127.0.0.1:8000/bugs/${this.editingBug.id}`, this.editingBug);
                this.showEditModal = false;
                await this.fetchBugs();
            } catch (error) {
                console.error('æ›´æ–°BUGå¤±è´¥:', error);
            }
        },
        async deleteBug(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªBUGå—ï¼Ÿ')) {
                try {
                    await axios.delete(`http://127.0.0.1:8000/bugs/${id}`);
                    await this.fetchBugs();
                } catch (error) {
                    console.error('åˆ é™¤BUGå¤±è´¥:', error);
                }
            }
        },
        openEditModal(bug) {
            this.editingBug = { ...bug };
            this.showEditModal = true;
        },
        searchBugs() {
            // æœç´¢é€»è¾‘ç”±computedå±æ€§filteredBugså¤„ç†
        }
    }
}).mount('#app');

</script>

</body>
</html>
